/*
 wherebear 2015-09-16 
*/
!function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Comment=function(a,b){this.init(a,b)},WB.app.Comment.prototype={init:function(b,c){this.cId=c.cId,this.uId=c.user_id,this.pId=c.pId,this.title=c.comment,this.wrap=a(b);var d=this;a("a.remove-comment",b).click(function(b){b.preventDefault();var c={cId:d.cId,uId:d.uId,pId:d.pId,title:d.title};a("body").trigger(WB.CONSTANTS.REMOVE_COMMENT,c)})},removeComment:function(){this.wrap.fadeOut(300,function(){this.remove()})},getComment:function(){return this.title},getCID:function(){return this.cId},getUID:function(){return this.uId},getPID:function(){return this.pId}}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.uastring=window.navigator.userAgent.toLowerCase(),WB.app.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/i.test(WB.app.uastring)||Modernizr.mq("(max-width: 579px)"),WB.app.isSafari=WB.app.uastring.indexOf("safari")>0&&WB.app.uastring.indexOf("chrome")<1,WB.app.GOOGLE_KEY="AIzaSyDZ1zdyQmvBjRvqyATW7QmVnnLFWAT05xo",WB.app.GEOCODE_URL="https://maps.googleapis.com/maps/api/geocode/json?address=[ADDRESS]&key="+WB.app.GOOGLE_KEY,WB.app.TWITTER_SHARE_URL="https://twitter.com/intent/tweet?url=",WB.app.FACEBOOK_SHARE_URL="https://www.facebook.com/sharer/sharer.php?u=",WB.CONSTANTS=WB.CONSTANTS||{},WB.CONSTANTS.OPEN_SAVE_PIN="OPEN_SAVE_PIN",WB.CONSTANTS.SAVE_PIN="SAVE_PIN",WB.CONSTANTS.ADD_COMMENT="ADD_COMMENT",WB.CONSTANTS.CLOSE_MARKER_INFO="CLOSE_MARKER_INFO",WB.CONSTANTS.SAVE_LOCATION="SAVE_LOCATION",WB.CONSTANTS.GET_MARKER_INFO="GET_MARKER_INFO",WB.CONSTANTS.MAP_READY="MAP_READY",WB.CONSTANTS.REMOVE_COMMENT="REMOVE_COMMENT",WB.CONSTANTS.REMOVE_PIN_FROM_LIST="REMOVE_PIN_FROM_LIST",WB.CONSTANTS.REMOVE_PIN="REMOVE_PIN",WB.CONSTANTS.GET_PIN_INFO="GET_PIN_INFO",WB.CONSTANTS.SHARE_URL="SHARE_URL",WB.CONSTANTS.MAP_BOUNDS_CHANGED="MAP_BOUNDS_CHANGED"}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Home=function(){console.log(this);this.init()},WB.app.Home.prototype={init:function(){var b=this;this.map=new WB.app.Map,this.map.getGeoLoc(),this.sideBar=new WB.app.Sidebar,this.commentModal=a("#commentModal"),this.isLoggedIn=!1,this.hasChanged=!1,this.searchInfo=a("#search-info"),this.addpin_btn=a(".addpin-btn"),this.hash_field=a("#hash-field"),this.sortSelect=a("select.sort-select"),this.loader=a(".loader"),this.currentSearch={};var c=WB.app.Utils.getURLParams();console.log("urlParams",c),WB.app.Utils.checkLogin(function(a){console.log("isAuth",a),b.isLoggedIn=a,a?b.addEvents(1):(b.addpin_btn.attr("disabled",!0),b.addEvents(2))}),a("body").bind(WB.CONSTANTS.ADD_COMMENT,function(a,c){b.addComment(c)}),a("body").bind(WB.CONSTANTS.REMOVE_COMMENT,function(a,c){console.log(c),b.removeComment(c)}),a("body").bind(WB.CONSTANTS.REMOVE_PIN,function(a,c){console.log(c),b.removePin(c)}),a("body").bind(WB.CONSTANTS.REMOVE_PIN_FROM_LIST,function(a,c){console.log(c),b.removePinFromList(c)}),a("body").bind(WB.CONSTANTS.OPEN_SAVE_PIN,function(a,c){b.isLoggedIn?(b.sideBar.savePinTemplate(c),b.sideBar.openSideBar(),b.map.closeMarkerInfo()):(b.sideBar.loginTemplate(),b.sideBar.openSideBar())}),a("body").bind(WB.CONSTANTS.SHARE_URL,function(a,c){b.shareURL(c)}),a("body").bind(WB.CONSTANTS.SAVE_PIN,function(a,c){b.savePin(c)}),a("body").bind(WB.CONSTANTS.GET_MARKER_INFO,function(a,c){WB.app.Api.getMarkerInfo(c.locId,function(a){b.sideBar.locationTemplate(a)}),b.sideBar.openSideBar()}),a("body").bind(WB.CONSTANTS.CLOSE_MARKER_INFO,function(a,c){console.log("close marker info"),b.map.closeMarkerInfo()}),a("body").bind(WB.CONSTANTS.MAP_READY,function(a,d){console.log("map ready"),b.checkPageState(c)}),a("body").bind(WB.CONSTANTS.MAP_BOUNDS_CHANGED,function(a,c){b.boundsChanged(c)})},boundsChanged:function(a){if(console.log(this.currentSearch),this.currentSearch){if(console.log("got here"),"new"!=this.currentSearch.type)return;this.getNewPins(this.currentSearch.hash,a.bounds,a.zoom,!0)}this.hasChanged=!0},addEvents:function(b){var c=this,d=a("#location-field"),e=a(".search-btn"),f=b;this.sortSelect.bind("change",function(b){console.log(a(this).val()),f=a(this).val()}),e.click(function(a){a.preventDefault();var b=c.hash_field.val(),e=d.val();console.log("search for stuff"),c.sideBar.closeSideBar(),c.searchClick(b,e,f)}),this.addpin_btn.click(function(b){b.preventDefault(),console.log("drop pin"),c.map.dropPin(),a(this).attr("disabled",!0)})},searchClick:function(a,b,c){var d=this;1==c?b?WB.app.MapUtils.geocodeLocation(b,function(a){console.log(a),alert("this doesnt work yet")}):d.getMyPins(a):2==c&&(b?WB.app.MapUtils.geocodeLocation(b,function(b){console.log(b),console.log(b.bounds),b.bounds?d.getNewPins(a,b.bounds,b.zoom):d.map.setNewBounds(b.location,b.zoom,function(c){d.getNewPins(a,c,b.zoom)})}):d.getNewPins(a,null)),console.log("loc",b),console.log("hash",a),console.log("sort",c)},checkPageState:function(b){console.log("checkPageState",b),a.isEmptyObject(b)?this.getNewPins("",null,6):(b.uid?(this.getUserPins(b.uid),console.log("show user map id= "+b.uid)):b.pid?(this.getPinInfo(b.pid),console.log("show pin id= ",b.pid+" info")):b.hash&&(this.getPinsByHash(b.hash),console.log("show pins with the hash "+b.hash)),self.currentSearch=null)},savePin:function(b){var c=this,d=a("#sidebar .glyphicon-ok");WB.app.Api.savePin(b,function(a){b.marker.changeMarkerProps(b.title,a),d.show(),c.map.setDroppedPin(),c.addpin_btn.removeAttr("disabled"),setTimeout(function(){c.sideBar.closeSideBar()},500)})},removePinFromList:function(a){var b=this;WB.app.Api.removePin(a,function(a){b.map.deleteMarker(a)})},removePin:function(a){var b=this;b.searchInfo.empty(),WB.app.Api.removePin(a,function(a){b.sideBar.closeSideBar(),b.map.deleteMarker(a)})},getNewPins:function(a,b,c,d){console.log("getNewPins");var e=this;e.currentSearch={type:"new",hash:a,zoom:c},e.searchInfo.empty(),this.loader.show(),WB.app.Api.getNewPins(a,b,function(f){console.log(f),e.loader.hide(),f.length<=0?(console.log("there are no results"),b?(e.map.clearMarkers(),e.map.panMapToBounds(b,c),e.sideBar.noResults()):alert("there are no bounds and no entries try again")):d||f.length>1?(e.map.setLocations(f,b,c),e.sideBar.newPinListTemplate(f,a),e.sideBar.openSideBar()):d||1!=f.length||(e.map.setSingleLocation(f[0]),e.sideBar.newPinListTemplate(f,a),e.sideBar.openSideBar())})},getMyPins:function(a){console.log("getMyPins");var b=this;b.currentSearch={type:"my",hash:a},this.loader.show(),b.searchInfo.empty(),WB.app.Api.getMyPins(a,function(a){b.loader.hide(),console.log("response",a),a.locations.length<=0?alert("thre are no results"):(b.map.setLocations(a.locations),b.sideBar.userPinListTemplate(a),b.sideBar.openSideBar())})},addComment:function(a){var b=this;console.log(a),WB.app.Api.addComment(a,function(a){b.commentModal.modal("hide"),b.sideBar.appendComment(a,0,!0)})},removeComment:function(a){console.log(a);var b=this;WB.app.Api.removeComment(a,function(a){b.sideBar.removeComment(a)})},getPinInfo:function(a){var b=this;this.loader.show(),b.searchInfo.empty(),WB.app.Api.getMarkerInfo(a,function(a){b.loader.hide(),b.map.setSingleLocation(a.location),b.sideBar.locationTemplate(a),b.sideBar.openSideBar(),b.searchInfo.empty();var c='<a href="#" class="share-twitter"><img src="/images/twitter_icon.png"/></a><a href="#" class="share-facebook"><img src="/images/fb_icon.png"/></a><h4>'+a.location.title+"</h4>";b.searchInfo.html(c),b.enableShare(),console.log(a)})},getUserPins:function(a){var b=this;b.searchInfo.empty(),this.loader.show(),WB.app.Api.getUserPins(a,function(a){b.loader.hide(),console.log(a),b.map.setLocations(a.locations),b.searchInfo.empty();var c='<a href="#" class="share-twitter"><img src="/images/twitter_icon.png"/></a><a href="#" class="share-facebook"><img src="/images/fb_icon.png"/></a><img src="'+a.user.imageURL+'"> <h4>'+a.user.username+"</h4>";b.searchInfo.html(c),b.sideBar.userPinListTemplate(a),b.sideBar.openSideBar(),b.enableShare(),console.log(a)})},getPinsByHash:function(a){var b=this;this.loader.show(),b.searchInfo.empty(),this.hash_field.val(a),this.sortSelect.val(2),WB.app.Api.getPinsByHash(a,function(c){if(b.loader.hide(),console.log(c),c.length<=0)alert("THERE ARE NO RESULTS");else{1==c.length?b.map.setSingleLocation(c[0]):b.map.setLocations(c),b.sideBar.newPinListTemplate(c,a),b.sideBar.openSideBar();var d='<a href="#" class="share-twitter"><img src="/images/twitter_icon.png" /></a><a href="#" class="share-facebook"><img src="/images/fb_icon.png"/></a><h4>#'+a+"</h4>";b.searchInfo.html(d),b.enableShare()}})},enableShare:function(){new WB.app.Social(this.searchInfo,null)},shareURL:function(a){console.log(a),WB.app.Api.getShortURL(a,function(b){"tw"==a.service?window.open(WB.app.TWITTER_SHARE_URL+b.url,"Wherebear Share Pin","resizable,scrollbars=yes,status=1,width=658, height=354"):window.open(WB.app.FACEBOOK_SHARE_URL+b.url,"Wherebear Share Pin","resizable,scrollbars=yes,status=1,width=550, height=350")})}}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Main=function(b){console.log(this);this.isOpen=!1;var c=a("body").attr("class");if(console.log(c),"home"==c){new WB.app.Home}this.init()},WB.app.Main.prototype={init:function(){this.config()},config:function(){}},a(function(){new WB.app.Main})}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Map=function(){var a=this;this.DEFAULT_LAT=40.7237653,this.DEFAULT_LNG=-73.9942829,this.DEFAULT_ZOOM=13,this.map={},this.markers=[],this.bounds={},this.droppedMarker={},this.mapCanvas=document.getElementById("map-canvas"),this.timeout={},console.log(this.mapCanvas),google.maps.event.addDomListener(window,"load",function(){a.init()})},WB.app.Map.prototype={init:function(){},getGeoLoc:function(){var a=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var c=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);a.configMap(c);WB.app.MapUtils.geocodeLatLng(c,function(b){a.createMarker(c,b,"My Location",!1,!0,null)})},function(){a.handleNoGeolocation(!0)}):a.handleNoGeolocation(!1)},setSingleLocation:function(a){console.log("set single location");new google.maps.LatLngBounds;this.clearMarkers();var b=new google.maps.LatLng(a.lat,a.lng);this.createMarker(b,a.address,a.title,!1,!1,a._id),this.map.panTo(b),this.map.setZoom(15)},panMapToBounds:function(a,b){console.log(a,b);var c=WB.app.MapUtils.setBounds(a);this.map.panTo(c.getCenter()),this.map.setZoom(b)},setLocations:function(b,c,d){console.log("setLocations");var e=this,f=new google.maps.LatLngBounds;c&&(f=WB.app.MapUtils.setBounds(c)),this.clearMarkers(),a.each(b,function(a,b){var c=new google.maps.LatLng(b.lat,b.lng);f.extend(c),e.createMarker(c,b.address,b.title,!1,!1,b._id)}),e.map.fitBounds(f),e.map.panToBounds(f),c&&this.map.setZoom(d)},configMap:function(b){var c=this,d=WB.app.MapUtils.getMapOptions(b);console.log("config map"),this.map=new google.maps.Map(document.getElementById("map-canvas"),d);var e=!1;google.maps.event.addListener(this.map,"idle",function(){if(!e){var b=document.getElementById("location-field");new google.maps.places.Autocomplete(b,{types:["(regions)"]});a("body").trigger(WB.CONSTANTS.MAP_READY),c.addMapListeners(),e=!0}})},addMapListeners:function(){var a=this;google.maps.event.addListener(this.map,"dragend",function(){a.checkDroppedPinLocation(),a.mapMoved()}),this.mapCanvas.addEventListener("mousewheel",function(b){a.MouseWheelHandler(b)},!0),this.mapCanvas.addEventListener("DOMMouseScroll",function(b){a.MouseWheelHandler(b)},!0),google.maps.event.addDomListener(window,"resize",function(){var b=a.map.getCenter();google.maps.event.trigger(a.map,"resize"),a.map.setCenter(b)})},MouseWheelHandler:function(a){var b=this,a=window.event||a;Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){b.mapMoved(),console.log("zoom_changed")},500)},mapMoved:function(){var b={bounds:WB.app.MapUtils.convertBounds(this.map.getBounds()),zoom:this.map.getZoom()};a("body").trigger(WB.CONSTANTS.MAP_BOUNDS_CHANGED,b)},checkDroppedPinLocation:function(){if(!a.isEmptyObject(this.droppedMarker)){var b=this.droppedMarker.getMarker(),c=this.map.getBounds().contains(b.getPosition());if(!c){var d=this.map.getCenter();b.setPosition(d)}}},setDroppedPin:function(){this.droppedMarker={}},createMarker:function(a,b,c,d,e,f){var g=new WB.app.Marker(this.map,a,b,c,d,e,f);this.markers.push(g)},dropPin:function(){console.log("dropPin"),this.createMarker(this.map.getCenter(),"","dropped pin",!0,!1,null),this.droppedMarker=this.markers[this.markers.length-1],console.log(this.droppedMarker)},handleNoGeolocation:function(a){console.log("handleNoGeolocation");var b="";b=a?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.";var c=new google.maps.LatLng(this.DEFAULT_LAT,this.DEFAULT_LNG);this.configMap(c),this.map.setZoom(this.DEFAULT_ZOOM)},clearMarkers:function(){var b;this.markers.length>0&&(a.each(this.markers,function(a,c){c.getIsUser()?b=c:c.getMarker().setMap(null)}),this.markers=[b])},closeMarkerInfo:function(){a.each(this.markers,function(a,b){this.closeInfo()})},getMarkers:function(){a.each(this.markers,function(a,b){console.log(b)})},deleteMarker:function(b){var c=this;a.each(this.markers,function(a,d){return d.getId()==b?(d.getMarker().setMap(null),c.markers.splice(a,1),!1):void 0})},getMap:function(){return this.map},setNewBounds:function(a,b,c){var d=new google.maps.LatLng(a.lat,a.lng);new google.maps.LatLngBounds;this.map.panTo(d),this.map.setZoom(b),google.maps.event.addListenerOnce(this.map,"idle",function(){console.log("this logs after the panTo finishes.");var a=WB.app.MapUtils.convertBounds(this.getBounds());c(a)})}}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Marker=function(a,b,c,d,e,f,g){this.marker={},this.infoWindow={},this.isAdd=e,this.title=d,this.latlng=b,this.id=g,this.isUser=f,this.init(a,b,c,d,e,f,g)},WB.app.Marker.prototype={init:function(b,c,d,e,f,g,h){var i=this;this.infoWindow=new google.maps.InfoWindow;var j="/images/map-marker.png";g?j="/images/user-map-marker.png":f&&(j="/images/new-map-marker.png"),this.marker=new google.maps.Marker({map:b,draggable:f?!0:!1,animation:f?google.maps.Animation.DROP:null,title:i.title,icon:j,position:i.latlng});var k=500,l={};google.maps.event.addListener(this.marker,"mouseover",function(){l=setTimeout(function(){i.infoWindow.setContent(i.title),i.infoWindow.open(b,i.marker)},k)}),google.maps.event.addListener(this.marker,"mouseout",function(){clearTimeout(l),i.closeInfo()}),google.maps.event.addListener(this.marker,"click",function(b){if(i.isAdd||i.isUser){this.latlng=this.position;var c=i,d=this.position;WB.app.MapUtils.geocodeLatLng(this.position,function(b){console.log(b);var e={address:b,lat:d.lat(),lng:d.lng(),marker:c};console.log(e),a("body").trigger(WB.CONSTANTS.OPEN_SAVE_PIN,e)})}else{var e={locId:i.id};a("body").trigger(WB.CONSTANTS.GET_MARKER_INFO,e)}}),google.maps.event.addListener(this.marker,"dragstart",function(a){i.infoWindow.close()}),google.maps.event.addListener(this.marker,"dragend",function(a){console.log(this.position)})},closeInfo:function(){this.infoWindow.close()},changeMarkerProps:function(a,b){console.log("changeMarkerProps"),this.marker.setDraggable(!1),this.marker.setIcon("/images/map-marker.png"),this.title=a,this.isAdd=!1,this.isUser=!1,this.id=b},getMarker:function(){return this.marker},getId:function(){return this.id},getIsUser:function(){return this.isUser}}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Pofile=function(a){},WB.app.Pofile.prototype={init:function(){this.mapContainer=a(".map"),this.map=new WB.app.Map,this.getUserPins()},getUserPins:function(){var b=this,c={uid:a("body").data("uid")};WB.app.Utils.getData("/api/getUserPins","POST",c,function(a){return console.log(a),a.location.length<=0?(b.mapContainer.html("<h4>you dont have any saved pins</h4>"),void console.log(b.mapContainer)):void b.map.setUserLocations(a.location)})}}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Sidebar=function(){console.log(this),this.content=a("#content"),this.sideBar=a("#sidebar"),this.sideBarInner=a("#sidebar .inner"),this.closeBtn=a(".close-btn"),this.commentModal=a("#commentModal"),this.commentTitle=a(".modal-header h5",this.commentModal),this.addCommentBtn=a("button.addCommentBtn",this.commentModal),this.commentField=a("textarea#comment-field",this.commentModal),this.map=a("#map-canvas"),this.isOpen=!1,this.comments=[],this.init()},WB.app.Sidebar.prototype={init:function(){var a=this;this.closeBtn.click(function(b){b.preventDefault(),a.closeSideBar()})},openSideBar:function(){this.sideBar.animate({right:"15px"},250)},closeSideBar:function(){this.sideBar.animate({right:"-300px"},250)},empty:function(){this.sideBarInner.empty()},loginTemplate:function(){var b=this;this.empty();var c=WB.app.Utils.createTemplate("sideLogin",null);this.sideBarInner.append(c),a(".cancelItem").click(function(a){a.preventDefault(),b.closeSideBar()})},noResults:function(){a(".user-pins",this.sideBar).empty(),a(".user-pins",this.sideBar).append("<p>There are no Results</p>")},savePinTemplate:function(b){this.empty();var c=this,d=b,e=WB.app.Utils.createTemplate("savePin",null);this.sideBarInner.append(e);var f=a("#pin-title"),g=a("#pin-tags");a(".addItem").click(function(b){b.preventDefault();var c=f.val(),e=WB.app.Utils.checkHash(g.val());return""===c?void alert("please enter a title"):e.length<=0?void alert("please enter at least one hashtag"):(d.title=c,d.hash=e,void a("body").trigger(WB.CONSTANTS.SAVE_PIN,d))}),a(".cancelItem").click(function(a){a.preventDefault(),c.closeSideBar()})},locationTemplate:function(b){var c=this;this.empty();var d=WB.app.Utils.createTemplate("pinInfo",b);c.sideBarInner.append(d);a(".location-comments",c.sideBarInner);if(a.each(b.comments,function(a,b){c.appendComment(b,a,!1)}),new WB.app.Social(c.sideBarInner,b),b.isAuth){var e=b.location.title,f=b.location._id;a(".comment").click(function(a){a.preventDefault(),c.addComment(e,f)}),a(".delete-pin").click(function(b){b.preventDefault();var c={pinId:f};a("body").trigger(WB.CONSTANTS.REMOVE_PIN,c),console.log("delete pin")})}},newPinListTemplate:function(a,b){var c={locations:a,hash:b};this.empty();var d=WB.app.Utils.createTemplate("newPinlist",c);this.sideBarInner.append(d),new WB.app.Social(this.sideBarInner,null)},userPinListTemplate:function(b){var c=this;this.empty();var d=WB.app.Utils.createTemplate("userPinlist",b);c.sideBarInner.append(d),new WB.app.Social(c.sideBarInner,b),a("a.delete-pin").click(function(b){b.preventDefault();var c=a(this).data("id"),d={pinId:c};a("body").trigger(WB.CONSTANTS.REMOVE_PIN_FROM_LIST,d);var e=a(this).parent(".well");e.fadeOut("400",function(){e.remove()})})},addComment:function(b,c){console.log(b,c);var d=this;this.commentTitle.text(b),this.commentModal.modal("show"),d.commentField.val(""),setTimeout(function(){d.commentField.focus()},500),this.addCommentBtn.click(function(b){b.preventDefault();var e=d.commentField.val();if(e.length<4)alert("TOO SHORT");else{var f={comment:e,pId:c};a("body").trigger(WB.CONSTANTS.ADD_COMMENT,f),console.log("submit comment")}})},appendComment:function(b,c,d){var e=a(".location-comments",self.sideBarInner),f=WB.app.Utils.createTemplate("appendComment",b);d?e.prepend(f):e.append(f);var g=a(a(".com-wrap",e)[c]),h=new WB.app.Comment(g,b);d?this.comments.unshift(h):this.comments.push(h)},removeComment:function(b){var c=this;a.each(this.comments,function(a,d){return d.getCID()==b?(d.removeComment(),c.comments.splice(a,1),!1):void 0})},logComments:function(){a.each(this.comments,function(a,b){console.log(b)})}}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Social=function(a,b){this.init(a,b)},WB.app.Social.prototype={init:function(b,c){var d={},b=a(b);c?d=c.location?WB.app.Utils.checkShareUrl("pid",c.location._id):WB.app.Utils.checkShareUrl("uid",c.user.user_id):d.url=document.location.href,a(".share-twitter",b).click(function(b){b.preventDefault();var c=d;c.service="tw",a("body").trigger(WB.CONSTANTS.SHARE_URL,c)}),a(".share-facebook",b).click(function(b){b.preventDefault();var c=d;c.service="fb",a("body").trigger(WB.CONSTANTS.SHARE_URL,c),console.log(this)}),a(".add-follow",b).click(function(a){a.preventDefault(),alert("follow user # "+uid)})}}}(jQuery),this.JST=this.JST||{},this.JST["public/src/templates/appendComment"]=Handlebars.template({1:function(a,b,c,d){return'        	<a href="#" class="glyphicon glyphicon-remove remove-comment"></a>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g=b.helperMissing,h="function",i=this.escapeExpression;return'\n    <div class="well well-sm">\n        <div class="info">\n            <span class="glyphicon glyphicon-comment" aria-hidden="true"></span>\n            <img src="'+i((f=null!=(f=b.imageURL||(null!=a?a.imageURL:a))?f:g,typeof f===h?f.call(a,{name:"imageURL",hash:{},data:d}):f))+'" />\n        </div>\n        <div class="desc">\n            <p><a href="/?uid='+i((f=null!=(f=b.user_id||(null!=a?a.user_id:a))?f:g,typeof f===h?f.call(a,{name:"user_id",hash:{},data:d}):f))+'">'+i((f=null!=(f=b.username||(null!=a?a.username:a))?f:g,typeof f===h?f.call(a,{name:"username",hash:{},data:d}):f))+"</a> "+i((f=null!=(f=b.timeSince||(null!=a?a.timeSince:a))?f:g,typeof f===h?f.call(a,{name:"timeSince",hash:{},data:d}):f))+"</p>\n            <p>"+i((f=null!=(f=b.comment||(null!=a?a.comment:a))?f:g,typeof f===h?f.call(a,{name:"comment",hash:{},data:d}):f))+"</p>\n        </div>\n"+(null!=(e=b["if"].call(a,null!=a?a.isMe:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"    </div>\n\n"},useData:!0}),this.JST["public/src/templates/newPinlist"]=Handlebars.template({1:function(a,b,c,d){var e;return"	<h3>#"+this.escapeExpression((e=null!=(e=b.hash||(null!=a?a.hash:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"hash",hash:{},data:d}):e))+'<a href="#" class="share-twitter"><img src="/images/twitter_icon_inv.png" /></a>\n	<a href="#" class="share-facebook"><img src="/images/fb_icon_inv.png" /></a></h3>\n'},3:function(a,b,c,d){return'\n\n	<h3>Newest Pins	<a href="#" class="share-twitter"><img src="/images/twitter_icon_inv.png" /></a>\n		<a href="#" class="share-facebook"><img src="/images/fb_icon_inv.png" /></a></h3>\n'},5:function(a,b,c,d){var e,f,g=b.helperMissing,h=this.escapeExpression,i="function";return'		<div class="well well-sm">\n			<!--'+(null!=(e=b["if"].call(a,null!=a?a.isMe:a,{name:"if",hash:{},fn:this.program(6,d,0),inverse:this.noop,data:d}))?e:"")+'-->\n	        <div class="info">\n	            <span>'+h((b.inc||a&&a.inc||g).call(a,d&&d.index,{name:"inc",hash:{},data:d}))+'.</span><img src="'+h((f=null!=(f=b.imageURL||(null!=a?a.imageURL:a))?f:g,typeof f===i?f.call(a,{name:"imageURL",hash:{},data:d}):f))+'" />\n	        </div>\n	        <div class="desc">\n	            <p><a href="/?pid='+h((f=null!=(f=b._id||(null!=a?a._id:a))?f:g,typeof f===i?f.call(a,{name:"_id",hash:{},data:d}):f))+'">'+h((f=null!=(f=b.title||(null!=a?a.title:a))?f:g,typeof f===i?f.call(a,{name:"title",hash:{},data:d}):f))+"</a>&nbsp;"+h((f=null!=(f=b.timeSince||(null!=a?a.timeSince:a))?f:g,typeof f===i?f.call(a,{name:"timeSince",hash:{},data:d}):f))+'</p>\n	            <p><a href="/?uid='+h((f=null!=(f=b.user_id||(null!=a?a.user_id:a))?f:g,typeof f===i?f.call(a,{name:"user_id",hash:{},data:d}):f))+'">'+h((f=null!=(f=b.username||(null!=a?a.username:a))?f:g,typeof f===i?f.call(a,{name:"username",hash:{},data:d}):f))+"</a></p>\n	            <p>\n"+(null!=(e=b.each.call(a,null!=a?a.hash:a,{name:"each",hash:{},fn:this.program(8,d,0),inverse:this.noop,data:d}))?e:"")+"				</p>\n	        </div>\n	    </div>\n"},6:function(a,b,c,d){return'\n        		<a href="#" class="glyphicon glyphicon-remove remove-comment"></a>\n    		'},8:function(a,b,c,d){var e=this.lambda,f=this.escapeExpression;return'						<a class="hash" href="/?hash='+f(e(a,a))+'">#'+f(e(a,a))+"</a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return(null!=(e=b["if"].call(a,null!=a?a.hash:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.program(3,d,0),data:d}))?e:"")+'<hr/>\n<div class="user-pins new">\n'+(null!=(e=b.each.call(a,null!=a?a.locations:a,{name:"each",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+"</div>"},useData:!0}),this.JST["public/src/templates/pinInfo"]=Handlebars.template({1:function(a,b,c,d){return' <a href="#" class="glyphicon glyphicon-remove delete-pin"></a> '},3:function(a,b,c,d){var e=this.lambda,f=this.escapeExpression;return'		<a href="/?hash='+f(e(a,a))+'">#'+f(e(a,a))+"</a>, \n"},5:function(a,b,c,d){return'<a href="#" class="glyphicon glyphicon-plus add-follow"></a>'},7:function(a,b,c,d){var e;return'<a href="#" class="glyphicon glyphicon-plus comment" data-pid="'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.location:a)?e._id:e,a))+'"></a>'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return"<h4>"+g(f(null!=(e=null!=a?a.location:a)?e.title:e,a))+" "+(null!=(e=b["if"].call(a,null!=a?a.isMe:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"</h4>\n<p>"+g(f(null!=(e=null!=a?a.location:a)?e.nDate:e,a))+"</p>\n<p>\n"+(null!=(e=b.each.call(a,null!=(e=null!=a?a.location:a)?e.hash:e,{name:"each",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+'</p>\n<hr/>\n<h4><img src="'+g(f(null!=(e=null!=a?a.location:a)?e.imageURL:e,a))+'" /><a href="/?uid='+g(f(null!=(e=null!=a?a.location:a)?e.user_id:e,a))+'">'+g(f(null!=(e=null!=a?a.location:a)?e.username:e,a))+"</a>"+(null!=(e=b["if"].call(a,null!=a?a.isAuth:a,{name:"if",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+'<a href="#" class="share-twitter"><img src="/images/twitter_icon_inv.png" /></a><a href="#" class="share-facebook"><img src="/images/fb_icon_inv.png" /></a></p></h4>\n\n<hr/>\n<div class="com-wrap">\n	<h4>Comments'+(null!=(e=b["if"].call(a,null!=a?a.isAuth:a,{name:"if",hash:{},fn:this.program(7,d,0),inverse:this.noop,data:d}))?e:"")+'</h4>\n</div>\n<div class="location-comments">\n\n</div>'},useData:!0}),this.JST["public/src/templates/savePin"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<h3>SAVE PIN</h3>\n<div class="form-group">\n    <p>\n        <input type="text" placeholder="title" class="form-control" autocomplete="off" id="pin-title">\n    </p>\n    <p>\n        <input type="text" placeholder="#hashtags" class="form-control" autocomplete="off" id="pin-tags">\n    </p>\n</div>\n\n<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>\n<button type="button" class="btn btn-default cancelItem">Cancel</button>\n<button type="button" class="btn btn-primary addItem">Add</button>\n'},useData:!0}),this.JST["public/src/templates/sideLogin"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<h3>SAVE PIN</h3>\n<h4>please login to save a pin</h4>\n\n<button type="button" class="btn btn-default cancelItem">Cancel</button>\n\n'},useData:!0}),this.JST["public/src/templates/userPinlist"]=Handlebars.template({1:function(a,b,c,d){return'<a href="#" class="glyphicon glyphicon-plus add-follow">'},3:function(a,b,c,d,e,f){var g,h,i=b.helperMissing,j=this.escapeExpression,k=this.lambda;return'		<div class="well well-sm">\n			\n'+(null!=(g=b["if"].call(a,null!=(g=null!=f[1]?f[1].user:f[1])?g.isMe:g,{name:"if",hash:{},fn:this.program(4,d,0,e,f),inverse:this.noop,data:d}))?g:"")+"\n			<span>"+j((b.inc||a&&a.inc||i).call(a,d&&d.index,{name:"inc",hash:{},data:d}))+'.</span>\n			<div class="holder">\n\n				<a href="/?pid='+j((h=null!=(h=b._id||(null!=a?a._id:a))?h:i,"function"==typeof h?h.call(a,{name:"_id",hash:{},data:d}):h))+'">\n					<p><strong>'+j(k(null!=a?a.title:a,a))+"</strong></p>\n					<p>"+j(k(null!=a?a.nDate:a,a))+"</p>\n				</a>\n					<p>\n"+(null!=(g=b.each.call(a,null!=a?a.hash:a,{name:"each",hash:{},fn:this.program(6,d,0,e,f),inverse:this.noop,data:d}))?g:"")+"					</p>\n			</div>\n		</div>\n"},4:function(a,b,c,d){var e;return'				<a href="#" class="glyphicon glyphicon-remove delete-pin" data-id='+this.escapeExpression((e=null!=(e=b._id||(null!=a?a._id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"_id",hash:{},data:d}):e))+"></a>\n"},6:function(a,b,c,d){var e=this.lambda,f=this.escapeExpression;return'							<a class="hash" href="/?hash='+f(e(a,a))+'">#'+f(e(a,a))+"</a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d,e,f){var g,h=this.lambda,i=this.escapeExpression;return'<h3>Locations</h3>\n<h4><img src="'+i(h(null!=(g=null!=a?a.user:a)?g.imageURL:g,a))+'" /><a href="/?uid='+i(h(null!=(g=null!=a?a.user:a)?g.user_id:g,a))+'">'+i(h(null!=(g=null!=a?a.user:a)?g.username:g,a))+"</a>\n	"+(null!=(g=b["if"].call(a,null!=a?a.isAuth:a,{name:"if",hash:{},fn:this.program(1,d,0,e,f),inverse:this.noop,data:d}))?g:"")+'</a>\n	<a href="#" class="share-twitter"><img src="/images/twitter_icon_inv.png" /></a>\n	<a href="#" class="share-facebook"><img src="/images/fb_icon_inv.png" /></a>\n</h4>\n\n<hr/>\n<div class="user-pins">\n'+(null!=(g=b.each.call(a,null!=a?a.locations:a,{name:"each",hash:{},fn:this.program(3,d,0,e,f),inverse:this.noop,data:d}))?g:"")+"</div>"},useData:!0,useDepths:!0}),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Api=function(){},WB.app.Api.prototype={},WB.app.Api.getMarkerInfo=function(a,b){var c={pinId:a};WB.app.Utils.getData("/api/getPinInfo","POST",c,function(a){console.log(a),b(a)})},WB.app.Api.getMyPins=function(a,b){var c={hash:a};WB.app.Utils.getData("/api/getMyPins","POST",c,function(a){a.error?alert("error getting my pins"):b(a)})},WB.app.Api.getUserPins=function(a,b){var c={uid:a};WB.app.Utils.getData("/api/getUserPins","POST",c,function(a){b(a)})},WB.app.Api.getNewPins=function(a,b,c){var d={hash:a,bounds:b};WB.app.Utils.getData("/api/getNewPins","POST",d,function(a){"error"!=a.status?c(a):alert(a.message)})},WB.app.Api.addComment=function(a,b){WB.app.Utils.getData("/api/addComment","POST",a,function(a){a.error?alert("error adding comment"):b(a)})},WB.app.Api.removeComment=function(a,b){WB.app.Utils.getData("/api/removeComment","POST",a,function(a){console.log(a),"success"==a.status?b(a.cId):alert("error removing comment")})},WB.app.Api.removePin=function(a,b){WB.app.Utils.getData("/api/removePin","POST",a,function(a){console.log(a),"success"==a.status?b(a.pId):alert("error removing pin")})},WB.app.Api.savePin=function(a,b){var c={address:a.address,lat:a.lat,lng:a.lng,hash:a.hash,title:a.title};WB.app.Utils.getData("/api/savePin","POST",c,function(a){console.log(a),"success"==a.status?b(a.id):alert("error saving pin")})},WB.app.Api.getPinsByHash=function(a,b){var c={hash:a};WB.app.Utils.getData("/api/getPinsByHash","POST",c,function(a){a.error?alert("error getting pins"):b(a)})},WB.app.Api.getShortURL=function(a,b){console.log(a);var c={url:a};WB.app.Utils.getData("/api/getShortURL","POST",c,function(a){"error"==a.status?alert(a.message):b(a)})}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.MapUtils=function(){},WB.app.MapUtils.prototype={},WB.app.MapUtils.geocodeLatLng=function(a,b){var c=new google.maps.Geocoder;c.geocode({latLng:a},function(a,c){c==google.maps.GeocoderStatus.OK?a[0]?b(a[0].formatted_address):alert("No results found"):alert("please drag marker to another location")})},WB.app.MapUtils.getMapOptions=function(a){var b=[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#d3d3d3"}]},{featureType:"transit",stylers:[{color:"#808080"},{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#b3b3b3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"
},{color:"#ffffff"},{weight:1.8}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#d7d7d7"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ebebeb"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#a7a7a7"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#efefef"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#696969"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#737373"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#d6d6d6"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#dadada"}]}],c={zoom:13,backgroundColor:"#25b3ee",scrollwheel:!0,overviewMapControl:!0,disableDefaultUI:!1,panControl:!1,streetViewControl:!1,mapTypeControl:!1,center:a,minZoom:3,maxZoom:17,draggable:!0,mapTypeControlOptions:{},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},styles:b};return c},WB.app.MapUtils.setSearchZoom=function(a){console.log(a);var b=a[0].types[0];return"route"==b||"street_number"==b?15:"neighborhood"==b||"sublocality"==b||"sublocality_level_1"==b?14:"locality"==b?11:"administrative_area_level_2"==b?13:"country"==b?5:"colloquial_area"==b?8:"continent"==b?3:6},WB.app.MapUtils.geocodeLocation=function(a,b){var c=encodeURIComponent(a),d=WB.app.GEOCODE_URL.replace("[ADDRESS]",c);WB.app.Utils.getData(d,"get",null,function(a){if(a.results.length>0){console.log(a.results[0]);var c={formatted:a.results[0].formatted_address,location:a.results[0].geometry.location,bounds:a.results[0].geometry.bounds,zoom:WB.app.MapUtils.setSearchZoom(a.results[0].address_components)};b(c)}else alert("cant find location")})},WB.app.MapUtils.convertBounds=function(a){var b=a.getSouthWest(),c=a.getNorthEast(),d={northeast:{lat:c.lat(),lng:c.lng()},southwest:{lat:b.lat(),lng:b.lng()}};return d},WB.app.MapUtils.setBounds=function(a){var b=new google.maps.LatLng(a.southwest.lat,a.southwest.lng),c=new google.maps.LatLng(a.northeast.lat,a.northeast.lng),d=new google.maps.LatLngBounds(b,c);return d}}(jQuery),function(a){"use strict";window.WB=window.WB||{},WB.app=WB.app||{},WB.app.Utils=function(){},WB.app.Utils.prototype={},WB.app.Utils.checkLogin=function(a){WB.app.Utils.getData("/api/checkLogin","GET",null,function(b){a(b.authenticated)})},WB.app.Utils.checkShareUrl=function(a,b){var c={};return"pid"==a?c.url=document.location.origin+"/?pid="+b:c.url=document.location.origin+"/?uid="+b,c},WB.app.Utils.getData=function(b,c,d,e,f){a.ajax({type:c,url:b,data:d,dataType:"json",success:function(a){e(a)},error:function(a){f?f():alert(a.status+" - "+a.statusText)}})},WB.app.Utils.createTemplate=function(a,b){var c="public/src/templates/",d=JST[c+a],e=b,f=d(e);return f},WB.app.Utils.checkHash=function(a){return a=a.replace(/,/g,""),a=a.replace(/#/g,""),a=a.split(" "),""===a[0]&&a.pop(),a},WB.app.Utils.getURLParams=function(){var a=new function(a){if(a.length>1)for(var b,c=0,d=a.substr(1).split("&");c<d.length;c++)b=d[c].split("="),this[unescape(b[0])]=b.length>1?unescape(b[1]):""}(window.location.search);return a},Handlebars.registerHelper("inc",function(a,b){return parseInt(a)+1})}(jQuery);